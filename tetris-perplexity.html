<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tetris</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #222;
    color: #fff;
    font-family: Arial, sans-serif;
  }
  #game {
    display: grid;
    grid-template-rows: repeat(20, 30px);
    grid-template-columns: repeat(10, 30px);
    gap: 1px;
    background: #111;
  }
  .cell {
    width: 30px;
    height: 30px;
    background: #333;
  }
  .filled {
    background: #0ff;
  }
  #score {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 20px;
  }
</style>
</head>
<body>
<div id="score">Skóre: 0</div>
<div id="game"></div>
<script>
const rows = 20;
const cols = 10;
const game = document.getElementById('game');
const cells = [];
const shapes = [
  [[1,1,1,1]], // I
  [[1,1],[1,1]], // O
  [[0,1,0],[1,1,1]], // T
  [[1,0,0],[1,1,1]], // L
  [[0,0,1],[1,1,1]], // J
  [[1,1,0],[0,1,1]], // S
  [[0,1,1],[1,1,0]]  // Z
];
let board = Array.from({length: rows}, () => Array(cols).fill(0));
let currentShape, posX, posY, score = 0;

for (let r = 0; r < rows * cols; r++) {
  const cell = document.createElement('div');
  cell.classList.add('cell');
  game.appendChild(cell);
  cells.push(cell);
}

function draw() {
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const idx = r * cols + c;
      cells[idx].className = 'cell' + (board[r][c] ? ' filled' : '');
    }
  }
  currentShape.forEach((row, y) => {
    row.forEach((value, x) => {
      if (value && posY + y >= 0) {
        const idx = (posY + y) * cols + (posX + x);
        cells[idx].classList.add('filled');
      }
    });
  });
}

function newShape() {
  currentShape = shapes[Math.floor(Math.random() * shapes.length)];
  posX = 3;
  posY = -1;
}

function collide() {
  return currentShape.some((row, y) =>
    row.some((value, x) =>
      value && (
        board[posY + y]?.[posX + x] || posY + y >= rows || posX + x < 0 || posX + x >= cols)
    )
  );
}

function merge() {
  currentShape.forEach((row, y) => {
    row.forEach((value, x) => {
      if (value) board[posY + y][posX + x] = 1;
    });
  });
}

function clearLines() {
  let cleared = 0;
  board = board.filter(row => row.some(v => !v));
  while (board.length < rows) {
    board.unshift(Array(cols).fill(0));
    cleared++;
  }
  score += cleared * 100;
  document.getElementById('score').textContent = 'Skóre: ' + score;
}

function rotate() {
  const rotated = currentShape[0].map((_, i) => currentShape.map(row => row[i])).reverse();
  const prevShape = currentShape;
  currentShape = rotated;
  if (collide()) currentShape = prevShape;
}

function drop() {
  posY++;
  if (collide()) {
    posY--;
    merge();
    clearLines();
    newShape();
    if (collide()) {
      alert('Konec hry!');
      board = Array.from({length: rows}, () => Array(cols).fill(0));
      score = 0;
      document.getElementById('score').textContent = 'Skóre: 0';
    }
  }
  draw();
}

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') { posX--; if (collide()) posX++; }
  if (e.key === 'ArrowRight') { posX++; if (collide()) posX--; }
  if (e.key === 'ArrowDown') drop();
  if (e.key === 'ArrowUp') rotate();
  draw();
});

newShape();
draw();
setInterval(drop, 800);
</script>
</body>
</html>
